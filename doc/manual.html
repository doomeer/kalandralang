<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Kalandralang User Manual</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header>
<h1 class="title">Kalandralang User Manual</h1>
</header>
<nav id="TOC">
<ul>
<li><a href="#getting-started">Getting Started</a><ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#command-line-help">Command-Line Help</a></li>
<li><a href="#update-game-data">Update Game Data</a></li>
<li><a href="#update-cost-data">Update Cost Data</a><ul>
<li><a href="#from-poeninja-and-tft">From poe.ninja and TFT</a></li>
<li><a href="#use-default-values">Use Default Values</a></li>
</ul></li>
<li><a href="#running-a-recipe">Running a Recipe</a></li>
<li><a href="#finding-identifiers">Finding Identifiers</a><ul>
<li><a href="#using-the-find-command">Using the Find Command</a></li>
<li><a href="#using-the-show-mod-pool-instruction">Using the Show Mod Pool Instruction</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#example-recipe">Example Recipe</a><ul>
<li><a href="#code">Code</a></li>
<li><a href="#run-once">Run Once</a></li>
<li><a href="#run-100-times">Run 100 Times</a></li>
</ul></li>
<li><a href="#costs">Costs</a></li>
<li><a href="#language-reference">Language Reference</a><ul>
<li><a href="#general-syntax-rules">General Syntax Rules</a><ul>
<li><a href="#comments">Comments</a></li>
<li><a href="#keywords">Keywords</a></li>
<li><a href="#numbers">Numbers</a></li>
<li><a href="#identifiers">Identifiers</a></li>
<li><a href="#labels">Labels</a></li>
<li><a href="#symbols">Symbols</a></li>
<li><a href="#whitespace">Whitespace</a></li>
</ul></li>
<li><a href="#computational-model">Computational Model</a><ul>
<li><a href="#program-point">Program Point</a></li>
<li><a href="#current-item">Current Item</a></li>
<li><a href="#set-aside-item">Set-Aside Item</a></li>
<li><a href="#current-imprint">Current Imprint</a></li>
<li><a href="#spendings-and-gains">Spendings and Gains</a></li>
<li><a href="#errors">Errors</a></li>
</ul></li>
<li><a href="#buying-a-base">Buying a Base</a></li>
<li><a href="#crafting-instructions">Crafting Instructions</a><ul>
<li><a href="#currencies">Currencies</a><ul>
<li><a href="#basic-currencies">Basic Currencies</a></li>
<li><a href="#conqueror-exalted-orbs">Conqueror Exalted Orbs</a></li>
<li><a href="#eldritch-currencies">Eldritch Currencies</a></li>
<li><a href="#betrayal-currencies">Betrayal Currencies</a></li>
<li><a href="#awakeners-orb">Awakener's Orb</a></li>
</ul></li>
<li><a href="#essences">Essences</a></li>
<li><a href="#fossils">Fossils</a></li>
<li><a href="#crafting-bench">Crafting Bench</a><ul>
<li><a href="#built-ins">Built-Ins</a></li>
<li><a href="#other-modifiers">Other Modifiers</a></li>
</ul></li>
<li><a href="#harvest-crafting">Harvest Crafting</a></li>
<li><a href="#beastcrafting">Beastcrafting</a><ul>
<li><a href="#split">Split</a></li>
<li><a href="#imprint">Imprint</a></li>
</ul></li>
<li><a href="#betrayal-crafting">Betrayal Crafting</a><ul>
<li><a href="#unveiling">Unveiling</a></li>
</ul></li>
<li><a href="#set-aside">Set Aside</a></li>
<li><a href="#swap">Swap</a></li>
<li><a href="#use-imprint">Use Imprint</a></li>
</ul></li>
<li><a href="#control-flow-instructions">Control-Flow Instructions</a><ul>
<li><a href="#blocks">Blocks</a></li>
<li><a href="#nesting-complex-instructions">Nesting Complex Instructions</a></li>
<li><a href="#label-definitions">Label Definitions</a></li>
<li><a href="#goto">Goto</a></li>
<li><a href="#stop">Stop</a></li>
<li><a href="#if-conditionals">If Conditionals</a></li>
<li><a href="#loops">Loops</a><ul>
<li><a href="#while-loops">While Loops</a></li>
<li><a href="#until-loops">Until Loops</a></li>
<li><a href="#repeat-loops">Repeat Loops</a></li>
</ul></li>
</ul></li>
<li><a href="#selling">Selling</a></li>
<li><a href="#other-instructions">Other Instructions</a><ul>
<li><a href="#echo">Echo</a></li>
<li><a href="#show">Show</a></li>
<li><a href="#show-mod-pool">Show Mod Pool</a></li>
<li><a href="#show-unveil-mod-pool">Show Unveil Mod Pool</a></li>
</ul></li>
<li><a href="#amounts">Amounts</a></li>
<li><a href="#conditions">Conditions</a><ul>
<li><a href="#constants">Constants</a></li>
<li><a href="#boolean-operators">Boolean Operators</a></li>
<li><a href="#parentheses-in-conditions">Parentheses in Conditions</a></li>
<li><a href="#predicates-on-current-item">Predicates on Current Item</a></li>
<li><a href="#comparisons">Comparisons</a></li>
</ul></li>
<li><a href="#arithmetic-expressions">Arithmetic Expressions</a><ul>
<li><a href="#constants-1">Constants</a></li>
<li><a href="#operators">Operators</a></li>
<li><a href="#parentheses-in-arithmetic-expressions">Parentheses in Arithmetic Expressions</a></li>
<li><a href="#item-properties">Item Properties</a><ul>
<li><a href="#modifier-tiers">Modifier Tiers</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h2 id="getting-started">Getting Started</h2>
<p>These instructions assume you are using Linux. If you want to use Kalandralang on Windows, you can have a look at <a href="https://fdopen.github.io/opam-repository-mingw/" class="uri">https://fdopen.github.io/opam-repository-mingw/</a> but you're on your own.</p>
<h3 id="installation">Installation</h3>
<p>Install <a href="http://opam.ocaml.org/">opam</a>. Create an Opam switch if you didn't already, with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">opam</span> switch create 4.13.1</a></code></pre></div>
<p>Clone Kalandralang:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">git</span> clone https://github.com/doomeer/kalandralang</a></code></pre></div>
<p>Ask Opam to build and install Kalandralang:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="ex">opam</span> install kalandralang</a></code></pre></div>
<p>This puts the executable in <code>~/.opam/4.13.1/bin/kalandralang</code>, so if you have <code>~/.opam/4.13.1/bin</code> in your <code>PATH</code> (which is the case if you told the opam installer to update your config files and if you restarted your terminal), you can run Kalandralang with:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">kalandralang</span></a></code></pre></div>
<p>If this doesn't work, try running this instead:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="ex">~/.opam/4.13.1/bin/kalandralang</span></a></code></pre></div>
<p>If this works but <code>kalandralang</code> doesn't, it means that you need to fix your <code>PATH</code>.</p>
<p>Once Kalandralang is installed, you probably want to:</p>
<ul>
<li><a href="#update-game-data">Update Game Data</a>;</li>
<li><a href="#update-cost-data">Update Cost Data</a>.</li>
</ul>
<h3 id="usage">Usage</h3>
<h4 id="command-line-help">Command-Line Help</h4>
<p>Run Kalandralang with <code>--help</code> for documentation of command-line parameters:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="ex">kalandralang</span> --help</a></code></pre></div>
<p>You can request help for a given subcommand, such as <code>run</code> or <code>find</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="ex">kalandralang</span> run --help</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="ex">kalandralang</span> find --help</a></code></pre></div>
<h4 id="update-game-data">Update Game Data</h4>
<p>Kalandralang requires data files from the <a href="https://github.com/brather1ng/RePoE">RePoE</a> project to run. Those data files contain the list of base items, modifiers etc. Kalandralang looks for those files:</p>
<ul>
<li>on Linux: in <code>~/.kalandralang/data</code>;</li>
<li>on other platforms: in <code>./data</code>.</li>
</ul>
<p>Kalandralang can download those files for you; just run:</p>
<pre><code>kalandralang update-data
</code></pre>
<p>You probably also want to <a href="#update-cost-data">Update Cost Data</a>.</p>
<h4 id="update-cost-data">Update Cost Data</h4>
<p>Kalandralang reads the cost of currencies, harvest crafts etc. from file <code>data/costs.json</code>. It is a good idea to regularly update this file. See <a href="#costs">Costs</a> for more information.</p>
<h5 id="from-poeninja-and-tft">From poe.ninja and TFT</h5>
<p>The following command uses <a href="https://poe.ninja">poe.ninja</a>'s API and reads from The Forbidden Trove's <a href="https://github.com/The-Forbidden-Trove/tft-data-prices/tree/master/lsc">repository</a> to generate file <code>data/costs.json</code> :</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"><span class="ex">kalandralang</span> update-costs</a></code></pre></div>
<p>If you are from the future, you may need to specify the league name:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"><span class="ex">kalandralang</span> update-costs --ninja-league Archnemesis</a></code></pre></div>
<p>You can also specify the folder to read from TFT's repository:</p>
<pre><code>kalandralang update-costs --tft-league lsc
</code></pre>
<h5 id="use-default-values">Use Default Values</h5>
<p>The following command generates file <code>data/costs.json</code> with default values:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1"><span class="ex">kalandralang</span> write-default-costs</a></code></pre></div>
<p>If for some reason <code>update-costs</code> does not work for you, you can use <code>write-default-costs</code> to start with a base file that you can then edit manually (see <a href="#costs">Costs</a>).</p>
<h4 id="running-a-recipe">Running a Recipe</h4>
<p>Write a recipe in a file, such as <code>busted-vaal-regalia.kld</code> (start from an <a href="#example-recipe">Example Recipe</a>), and ask <code>kalandralang</code> to run it:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1"><span class="ex">kalandralang</span> run busted-vaal-regalia.kld</a></code></pre></div>
<h4 id="finding-identifiers">Finding Identifiers</h4>
<p>Recipes contain identifiers for base object types and modifiers. There are multiple ways to find those identifiers.</p>
<h5 id="using-the-find-command">Using the Find Command</h5>
<p>You can use the <code>find</code> command to find them.</p>
<p>For instance, to find the identifier for the Agate Amulet base type:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1"><span class="ex">kalandralang</span> find agate</a></code></pre></div>
<p>This tells you that the identifier is <code>&quot;Metadata/Items/Amulets/Amulet9&quot;</code>. This is the internal name in Path of Exile data files.</p>
<p>To find the identifier for the +1 to Level of all Chaos Skill Gems:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" title="1"><span class="ex">kalandralang</span> find <span class="st">&#39;level*chaos skill&#39;</span></a></code></pre></div>
<p>This finds all base types and modifiers that match pattern <code>level*chaos skill</code>, where <code>*</code> can be anything. This gives two results:</p>
<ul>
<li><code>&quot;GlobalChaosGemLevelInfluence1__&quot;</code>, the old Hunter (known as &quot;basilisk&quot; internally) influence mod which now has a spawn weight of 0 and thus cannot spawn anymore;</li>
<li><code>&quot;GlobalChaosGemLevel1&quot;</code>, the 3.17 non-influenced version of the mod.</li>
</ul>
<h5 id="using-the-show-mod-pool-instruction">Using the Show Mod Pool Instruction</h5>
<p>To find the identifier for a modifier, you can also use the <code>show_mod_pool</code> instruction (see <a href="#show-mod-pool">Show Mod Pool</a>). For instance, here is a recipe that shows all modifiers that can spawn on a non-influenced Agate Amulet:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" title="1"><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></a>
<a class="sourceLine" id="cb16-2" title="2"></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="co"># We want the item to have no modifier so that we see all modifiers that can spawn.</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co"># Otherwise, we would not see modifiers that are blocked by existing modifiers.</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="co"># But we cannot just scour because no modifier can spawn on normal items.</span></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="co"># So we use annul until there is no modifier.</span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="co"># Orbs of Annulments keep the item rare.</span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="kw">until</span> <span class="ex">no_prefix</span> <span class="kw">&amp;&amp;</span> <span class="ex">no_suffix</span> do annul</a>
<a class="sourceLine" id="cb16-9" title="9"><span class="ex">show_mod_pool</span></a></code></pre></div>
<h2 id="example-recipe">Example Recipe</h2>
<h3 id="code">Code</h3>
<p>Here is an example recipe to make a fire amulet. You can also find the code in <code>examples/fire-amulet.kld</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># This recipe produces Citrine Amulets with:</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="co"># - +1 to Level of All Fire Skill Gems</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co"># - Life</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="co"># - Increased Fire Damage</span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="co"># - Increased Cast Speed</span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="co"># - Increased Spell Damage</span></a>
<a class="sourceLine" id="cb17-7" title="7"></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="co"># First, we buy a base.</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="co">#</span></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="co"># Citrine Amulet&#39;s internal name is &quot;Metadata/Items/Amulets/Amulet10&quot;.</span></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="co"># To find this identifier, run: kalandralang find citrine</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="co">#</span></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="co"># We buy one with item level 84 for 1 chaos.</span></a>
<a class="sourceLine" id="cb17-14" title="14"><span class="co"># Kalandralang will choose a random rare amulet for us.</span></a>
<a class="sourceLine" id="cb17-15" title="15"><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet10&quot;</span> ilvl 84 for 1 chaos</a>
<a class="sourceLine" id="cb17-16" title="16"></a>
<a class="sourceLine" id="cb17-17" title="17"><span class="co"># Let&#39;s display the current item.</span></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="bu">echo</span> <span class="st">&quot;Item we bought:&quot;</span></a>
<a class="sourceLine" id="cb17-19" title="19"><span class="ex">show</span></a>
<a class="sourceLine" id="cb17-20" title="20"></a>
<a class="sourceLine" id="cb17-21" title="21"><span class="co"># Then, we start working on the suffixes.</span></a>
<a class="sourceLine" id="cb17-22" title="22"><span class="co"># We spam Deafening Essence of Zeal until the amulet has both the essence mod</span></a>
<a class="sourceLine" id="cb17-23" title="23"><span class="co"># (i.e. Increased Cast Speed) and Tier 1 Increased Fire Damage.</span></a>
<a class="sourceLine" id="cb17-24" title="24"><span class="co">#</span></a>
<a class="sourceLine" id="cb17-25" title="25"><span class="co"># Increased Fire Damage&#39;s internal name is &quot;FireDamagePercent5&quot;.</span></a>
<a class="sourceLine" id="cb17-26" title="26"><span class="co"># To find this identifier, run: kalandralang find &#39;increased fire damage&#39;</span></a>
<a class="sourceLine" id="cb17-27" title="27"><span class="co"># This gives a lot of results; an alternative is to go to</span></a>
<a class="sourceLine" id="cb17-28" title="28"><span class="co"># https://poedb.tw/us/Amulets#ModifiersCalc, click on the mod you are interested in,</span></a>
<a class="sourceLine" id="cb17-29" title="29"><span class="co"># click on the &quot;i&quot; icon next to the tier you want, and copy-paste the Mod Id.</span></a>
<a class="sourceLine" id="cb17-30" title="30"><span class="co">#</span></a>
<a class="sourceLine" id="cb17-31" title="31"><span class="co"># &quot;repeat&quot; causes the instruction (here &quot;essence_of_zeal&quot;) to always be executed</span></a>
<a class="sourceLine" id="cb17-32" title="32"><span class="co"># at least once. This ensures that we do have the essence mod even if the amulet</span></a>
<a class="sourceLine" id="cb17-33" title="33"><span class="co"># already had &quot;FireDamagePercent5&quot; when we bought it.</span></a>
<a class="sourceLine" id="cb17-34" title="34"><span class="ex">repeat</span> essence_of_zeal until has <span class="st">&quot;FireDamagePercent5&quot;</span></a>
<a class="sourceLine" id="cb17-35" title="35"></a>
<a class="sourceLine" id="cb17-36" title="36"><span class="co"># Let&#39;s display the current item.</span></a>
<a class="sourceLine" id="cb17-37" title="37"><span class="bu">echo</span> <span class="st">&quot;Item after essence spam:&quot;</span></a>
<a class="sourceLine" id="cb17-38" title="38"><span class="ex">show</span></a>
<a class="sourceLine" id="cb17-39" title="39"></a>
<a class="sourceLine" id="cb17-40" title="40"><span class="co"># Now that we are happy with our suffixes, we start working on our prefixes.</span></a>
<a class="sourceLine" id="cb17-41" title="41"><span class="co">#</span></a>
<a class="sourceLine" id="cb17-42" title="42"><span class="co"># We will use Harvest to augment fire.</span></a>
<a class="sourceLine" id="cb17-43" title="43"><span class="co"># But first we need to make sure the amulet has two open prefixes:</span></a>
<a class="sourceLine" id="cb17-44" title="44"><span class="co"># - one for the augment itself;</span></a>
<a class="sourceLine" id="cb17-45" title="45"><span class="co"># - and one to craft Adds # to # Fire Damage to Attacks</span></a>
<a class="sourceLine" id="cb17-46" title="46"><span class="co">#   to ensure the augment gives us +1 to Level of All Fire Skill Gems.</span></a>
<a class="sourceLine" id="cb17-47" title="47"><span class="co">#</span></a>
<a class="sourceLine" id="cb17-48" title="48"><span class="co"># Additionally, we take the opportunity to ensure that we have Increased Spell Damage</span></a>
<a class="sourceLine" id="cb17-49" title="49"><span class="co"># on the amulet.</span></a>
<a class="sourceLine" id="cb17-50" title="50"><span class="co">#</span></a>
<a class="sourceLine" id="cb17-51" title="51"><span class="co"># To do that, we use Harvest to reforge keeping suffixes until there are</span></a>
<a class="sourceLine" id="cb17-52" title="52"><span class="co"># two open prefixes (i.e. exactly 1 prefix), and Increased Spell Damage.</span></a>
<a class="sourceLine" id="cb17-53" title="53"><span class="co"># The internal name for this modifier is:</span></a>
<a class="sourceLine" id="cb17-54" title="54"><span class="co"># - &quot;SpellDamage5&quot; for Tier 1;</span></a>
<a class="sourceLine" id="cb17-55" title="55"><span class="co"># - &quot;SpellDamage4&quot; for Tier 2.</span></a>
<a class="sourceLine" id="cb17-56" title="56"><span class="co"># We are happy with Tier 2, but it doesn&#39;t mean we don&#39;t want Tier 1,</span></a>
<a class="sourceLine" id="cb17-57" title="57"><span class="co"># so our stopping condition checks for both mods.</span></a>
<a class="sourceLine" id="cb17-58" title="58"><span class="co">#</span></a>
<a class="sourceLine" id="cb17-59" title="59"><span class="co"># &quot;until&quot; does not execute the instruction (here &quot;harvest_reforge_keep_suffixes&quot;)</span></a>
<a class="sourceLine" id="cb17-60" title="60"><span class="co"># if the condition already holds.</span></a>
<a class="sourceLine" id="cb17-61" title="61"><span class="kw">until</span> <span class="ex">prefix_count</span> 1 and (has <span class="st">&quot;SpellDamage5&quot;</span> or has <span class="st">&quot;SpellDamage4&quot;</span>) <span class="kw">do</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb17-62" title="62">  <span class="ex">harvest_reforge_keep_suffixes</span></a>
<a class="sourceLine" id="cb17-63" title="63"><span class="kw">}</span></a>
<a class="sourceLine" id="cb17-64" title="64"></a>
<a class="sourceLine" id="cb17-65" title="65"><span class="co"># Let&#39;s display the current item.</span></a>
<a class="sourceLine" id="cb17-66" title="66"><span class="bu">echo</span> <span class="st">&quot;Item after harvest reforges:&quot;</span></a>
<a class="sourceLine" id="cb17-67" title="67"><span class="ex">show</span></a>
<a class="sourceLine" id="cb17-68" title="68"></a>
<a class="sourceLine" id="cb17-69" title="69"><span class="co"># Let&#39;s craft Adds # to # Fire Damage to Attacks and augment fire to get</span></a>
<a class="sourceLine" id="cb17-70" title="70"><span class="co"># our +1 to Level of All Fire Skill Gems.</span></a>
<a class="sourceLine" id="cb17-71" title="71"><span class="ex">craft</span> <span class="st">&quot;EinharMasterAddedFireDamage1&quot;</span></a>
<a class="sourceLine" id="cb17-72" title="72"><span class="ex">harvest_augment_fire</span></a>
<a class="sourceLine" id="cb17-73" title="73"></a>
<a class="sourceLine" id="cb17-74" title="74"><span class="co"># Finally, let&#39;s craft life and call it a day!</span></a>
<a class="sourceLine" id="cb17-75" title="75"><span class="ex">remove_crafted_mods</span></a>
<a class="sourceLine" id="cb17-76" title="76"><span class="ex">craft</span> <span class="st">&quot;EinharMasterIncreasedLife3&quot;</span></a>
<a class="sourceLine" id="cb17-77" title="77"></a>
<a class="sourceLine" id="cb17-78" title="78"><span class="co"># Let&#39;s say that we can sell this for 10 Exalted Orbs.</span></a>
<a class="sourceLine" id="cb17-79" title="79"><span class="ex">gain</span> 10 exalt</a></code></pre></div>
<h3 id="run-once">Run Once</h3>
<p>Run this recipe with:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" title="1"><span class="ex">kalandralang</span> run examples/fire-amulet.kld</a></code></pre></div>
<p>Here is an example run:</p>
<pre><code>Item we bought:
--------
Citrine Amulet (Rare)
--------
(prefix) +29 to maximum Life (IncreasedLife2)
(prefix) 20% increased maximum Energy Shield (IncreasedEnergyShieldPercent7)
(suffix) +24% to Global Critical Strike Multiplier (CriticalMultiplier3)
(suffix) +17% to Cold Resistance (ColdResist2)
--------
Paid up to now: 0.01ex (1c)
Item after essence spam:
--------
Citrine Amulet (Rare)
--------
(prefix) 0.73% of Physical Attack Damage Leeched as Life (LifeLeechPermyriad2)
(suffix) 25% increased Fire Damage (FireDamagePercent5)
(suffix) 18% increased Cast Speed (IncreasedCastSpeed4)
(suffix) +38% to Global Critical Strike Multiplier (CriticalMultiplier6)
--------
Paid up to now: 3.49ex (604c)
Item after harvest reforges:
--------
Citrine Amulet (Rare)
--------
(prefix) 18% increased Spell Damage (SpellDamage4)
(suffix) 24% increased Fire Damage (FireDamagePercent5)
(suffix) 18% increased Cast Speed (IncreasedCastSpeed4)
(suffix) +36% to Global Critical Strike Multiplier (CriticalMultiplier6)
--------
Paid up to now: 18.49ex (3198c)
--------
Citrine Amulet (Rare)
--------
(prefix) 18% increased Spell Damage (SpellDamage4)
(prefix) +1 to Level of all Fire Skill Gems (GlobalFireGemLevel1_)
(suffix) 23% increased Fire Damage (FireDamagePercent5)
(suffix) 18% increased Cast Speed (IncreasedCastSpeed4)
(suffix) +38% to Global Critical Strike Multiplier (CriticalMultiplier6)
(prefix) {crafted} +45 to maximum Life (EinharMasterIncreasedLife3)
--------
Cost:
     1 × chaos
    10 × harvest_reforge_keep_suffixes
     1 × remove_crafted_mods
   201 × essence_of_zeal
     1 × harvest_augment_fire
     1 × craft &quot;EinharMasterAddedFireDamage1&quot;
     1 × craft &quot;EinharMasterIncreasedLife3&quot;
Total: 28.50ex (4928c) — Profit: -18.50ex (-3198c)
</code></pre>
<h3 id="run-100-times">Run 100 Times</h3>
<p>Run this recipe 100 times with:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb20-1" title="1"><span class="ex">kalandralang</span> run examples/fire-amulet.kld -c 100</a></code></pre></div>
<p>Kalandralang eventually tells us:</p>
<pre><code>Average cost (out of 100):
     1.00 × chaos
    75.55 × harvest_reforge_keep_suffixes
     1.00 × remove_crafted_mods
   152.01 × essence_of_zeal
     1.00 × harvest_augment_fire
     1.00 × craft &quot;EinharMasterAddedFireDamage1&quot;
     1.00 × craft &quot;EinharMasterIncreasedLife3&quot;
Total: 125.97ex (21785c) — Profit: -115.97ex (-20055c)

     █                                                                          
   ▆ █                                                                          
   █ █ ▅   ▅                                                                    
 ▃ █ █ █  ▃█                                                                    
 █ █ █ █ ▂██                                                                    
 █ █ █ █ ███                                                                    
 █ █████ ███                                                                    
 █▆█████▆███                                                                    
 ███████████▅ ▅      ▅                                                          
 ████████████ █▃▃▃  ▃█▃ ▃                                                       
▂████████████ ████▂ ███ █▂▂    ▂                ▂                               
█████████████ █████ ███ ███    █                █                               
‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾
0ex                                                                       1000ex
</code></pre>
<p>It looks like this recipe is really not worth it!</p>
<p>It looks like hoping to get Increased Spell Damage with Harvest reforge keeping suffixes is very costly. Using Harvest augment fire to get +1 to Level of All Fire Skill Gems is also not cheap, maybe we should have started with the prefixes by spamming Alteration Orbs. Can you improve the recipe to make it less ambitious but also less catastrophic?</p>
<h2 id="costs">Costs</h2>
<p>To estimate the cost of each craft, Kalandralang needs to know the value of currencies, harvest crafts etc. Kalandralang has default values for each of those, but those values are unlikely to be very accurate as values change a lot over time. You can customize those values by creating a file named <code>costs.json</code> in the <code>data</code> directory that you set up in <a href="#setup-a-working-directory">Setup a Working Directory</a>.</p>
<p>To customize costs, it is recommended to generate <code>data/costs.json</code> using <code>write-default-costs</code> or <code>update-costs</code> (see <a href="#update-cost-data">Update Cost Data</a>). You can then edit the values in this file manually.</p>
<p>This file is a <a href="https://www.json.org">JSON</a> file composed of one JSON object. The name of each field is usually a keyword corresponding to an instruction. For instance, field <code>&quot;exalt&quot;</code> specifies the value of Exalted Orbs, field <code>&quot;harvest_reforge_life&quot;</code> specifies the cost of the <code>harvest_reforge_life</code> <a href="#harvest-crafting">instruction</a>, and field <code>&quot;pristine&quot;</code> specifies the value of Pristine Fossils. For resonators, the fields are named <code>&quot;primitive_resonator&quot;</code>, <code>&quot;potent_resonator&quot;</code>, <code>&quot;powerful_resonator&quot;</code> and <code>&quot;prime_resonator&quot;</code>. The value of each field is the cost in chaos.</p>
<p>For instance, the following <code>costs.json</code> file:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb22-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb22-2" title="2">  <span class="dt">&quot;exalt&quot;</span><span class="fu">:</span> <span class="dv">150</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb22-3" title="3">  <span class="dt">&quot;hunter_exalt&quot;</span><span class="fu">:</span> <span class="dv">225</span></a>
<a class="sourceLine" id="cb22-4" title="4"><span class="fu">}</span></a></code></pre></div>
<p>specifies that the value of Exalted Orbs is 150 Chaos Orbs, and that the value of Hunter Exalted Orbs is 225 Chaos Orbs.</p>
<p>If the value of a given instruction is not specified (i.e. does not appear in the file or is defined as <code>null</code>), its default value is used.</p>
<h2 id="language-reference">Language Reference</h2>
<h3 id="general-syntax-rules">General Syntax Rules</h3>
<h4 id="comments">Comments</h4>
<p>Comments start with character <code>#</code> and end at the end of lines. For instance:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb23-1" title="1"><span class="co"># This line is a comment</span></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="ex">exalt</span> <span class="co"># This is also a comment, but &quot;exalt&quot; isn&#39;t</span></a></code></pre></div>
<p>Comments are ignored by the interpreter. Use them to make your code more readable.</p>
<h4 id="keywords">Keywords</h4>
<p>Keywords are composed of lowercase letters (<code>a</code> to <code>z</code>) and underscores <code>_</code>. They are predefined and correspond to language instructions. Here are some examples:</p>
<ul>
<li><code>harvest_reforge_life</code>;</li>
<li><code>chaos</code>;</li>
<li><code>while</code>.</li>
</ul>
<h4 id="numbers">Numbers</h4>
<p>Numbers are sequences of digits (<code>0</code> to <code>9</code>), optionally prefixed by a minus character <code>-</code> for negative numbers. Examples:</p>
<ul>
<li><code>0</code>;</li>
<li><code>1234</code>;</li>
<li><code>-9</code>.</li>
</ul>
<h4 id="identifiers">Identifiers</h4>
<p>Identifiers start and end with double quotes <code>&quot;</code>. For instance:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">if</span> <span class="ex">has</span> <span class="st">&quot;GlobalSkillGemLevel1&quot;</span> then gain 15 exalt</a></code></pre></div>
<p>In this example, <code>&quot;GlobalSkillGemLevel1&quot;</code> is the identifier for the +1 to Level of all Chaos Skill Gems modifier.</p>
<p>See also <a href="#finding-identifiers">Finding Identifiers</a>.</p>
<h4 id="labels">Labels</h4>
<p>Labels start with a period <code>.</code> which is followed by lowercase or uppercase letters (<code>a</code> to <code>z</code> and <code>A</code> to <code>Z</code>), digits (<code>0</code> to <code>9</code>), and underscores <code>_</code>. They are used to refer to a given position in the code, to be able to jump to this position from other parts of the code. Here are some examples:</p>
<ul>
<li><code>.attempt_to_reforge_life</code>;</li>
<li><code>.fail_miserably_for_the_3rd_time_and_try_again</code>.</li>
</ul>
<p>Well-chosen label names help to make the code more readable.</p>
<h4 id="symbols">Symbols</h4>
<p>The language uses the following symbol characters:</p>
<ul>
<li>parentheses <code>(</code> and <code>)</code> in condition expressions;</li>
<li>braces <code>{</code> and <code>}</code> for blocks of instructions;</li>
<li>colon <code>:</code> after label definitions;</li>
<li>dash <code>-</code> (also known as &quot;minus&quot;) for ranges of values.</li>
</ul>
<h4 id="whitespace">Whitespace</h4>
<p>In general, whitespace (blanks, tabs and newlines) is ignored. Although you do have to separate keywords and numbers with whitespace (for instance <code>abc</code> is one keyword, but <code>a bc</code> is two), and newlines do matter to end comments.</p>
<h3 id="computational-model">Computational Model</h3>
<h4 id="program-point">Program Point</h4>
<p>Recipes are sequences of instructions. For instance:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" title="1"><span class="ex">transmute</span></a>
<a class="sourceLine" id="cb25-2" title="2"><span class="ex">regal</span></a>
<a class="sourceLine" id="cb25-3" title="3"><span class="ex">exalt</span></a></code></pre></div>
<p>is a recipe composed of three instructions. The first one is to apply an Orb of Transmutation, the second one is to apply a Regal Orb, and the third one is to apply an Exalted Orb.</p>
<p>When executing a recipe, Kalandralang keeps track of the <em>program point</em>, which is the next instruction to perform. At the very start, this is the first instruction of the program. After each instruction, the program point automatically moves on to the next instruction in the sequence, except if the instruction which was just executed is a <a href="#control-flow-instructions">Control-Flow Instruction</a>, in which case it may move somewhere else.</p>
<h4 id="current-item">Current Item</h4>
<p>When executing a recipe, Kalandralang stores a <em>current item</em> in memory. At the very start, there is no current item, so usually the first instruction is to <code>buy</code> a base (see <a href="#buying-a-base">Buying a Base</a>). After that, each instruction can modify the current item or replace it completely. For instance, <code>transmute</code> is an instruction that applies an Orb of Transmutation on the current item.</p>
<p>Some instructions contain conditions. Those conditions are evaluated on the current item. For instance, <code>no_suffix</code> is a condition that evaluates to <code>true</code> if the current item has no suffix.</p>
<h4 id="set-aside-item">Set-Aside Item</h4>
<p>When executing a recipe, Kalandralang stores a <em>set-aside item</em> in memory. At the very start, there is no set-aside item. Use the <code>set_aside</code> instruction to set the current item aside (see <a href="#set-aside">Set Aside</a>). Items can be set aside for <a href="#awakeners-orb">Awakener's Orb</a> in particular. Note that <a href="#split">Splitting</a> an item replaces the set-aside item.</p>
<h4 id="current-imprint">Current Imprint</h4>
<p>When executing a recipe, Kalandralang stores a <em>current imprint</em> in memory. At the very start, there is no current imprint. Use the <code>beastcraft_imprint</code> instruction to make an imprint of the current item (see <a href="#imprint">Imprint</a>). Use the <code>use_imprint</code> instruction to restore the current item to the current imprint (see <a href="#use-imprint">Use Imprint</a>).</p>
<h4 id="spendings-and-gains">Spendings and Gains</h4>
<p>When executing a recipe, Kalandralang counts how much you spend. Each instruction can add to this number. For instance, <code>exalt</code> adds one Exalted Orb to your spendings. Kalandralang also counts how much you gain (see <a href="#selling">Selling</a>). At the end, Kalandralang can show total spendings and earnings.</p>
<h4 id="errors">Errors</h4>
<p>It may be possible for instructions to fail. For instance, <code>transmute</code> fails if the current item is not of normal rarity. Failures cause the recipe to stop immediately with an error message. If this happens, you should modify your recipe to ensure that it does not try to perform invalid instructions. For instance, you could add an <code>if</code> instruction before an <code>augment</code> to only perform the <code>augment</code> if the item has an open prefix or an open suffix:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb26-1" title="1"><span class="kw">if</span> <span class="ex">open_prefix</span> or open_suffix then augment</a></code></pre></div>
<h3 id="buying-a-base">Buying a Base</h3>
<p><code>buy [&lt;influence&gt;] [&lt;influence&gt;] &lt;identifier&gt; [ilvl &lt;number&gt;] [with [fractured] &lt;identifier&gt;]* [for &lt;amount&gt;]</code> is an instruction that sets or replaces the current item to a given base.</p>
<ul>
<li><code>&lt;influence&gt;</code> are keywords that can be used to specify that the item has this influence. Zero, one or two influences can be specified. Influence keywords are: <code>shaper</code>, <code>elder</code>, <code>crusader</code>, <code>hunter</code>, <code>redeemer</code>, <code>warlord</code>, <code>exarch</code>, <code>eater</code>, <code>synthesized</code>.</li>
<li>The first identifier is the base type, such as <code>&quot;Metadata/Items/Amulets/Amulet9&quot;</code> for Agate Amulets.</li>
<li><code>ilvl &lt;number&gt;</code> is optional and sets the item level. It defaults to 100. For instance, <code>ilvl 84</code> sets the item level to 84.</li>
<li><code>with &lt;identifier&gt;</code> constrains the item to have a given modifier, specified with the given identifier. For instance, <code>with &quot;GlobalChaosGemLevel1&quot;</code> specifies that the item must have +1 to Level of all Chaos Skill Gems. This parameter is repeatable.</li>
<li><code>with fractured &lt;identifier&gt;</code> is the same as <code>with &lt;identifier&gt;</code> but the modifier is fractured.</li>
<li><code>for &lt;amount&gt;</code> specifies the cost of the item. It causes the given <a href="#amounts">Amount</a> to be added to your <a href="#spendings-and-gains">Spendings</a>. It defaults to zero.</li>
</ul>
<p>Note that the base item will be rare, with 4 to 6 modifiers, following the distribution of chaos orbs. If you specify one modifier, the item will have 3 to 5 other modifiers at random. If you specify two modifiers, the item will have 2 to 4 other modifiers at random. Etc.</p>
<p>For instance, here is how to start from a random rare Agate Amulet of item level 100:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb27-1" title="1"><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></a></code></pre></div>
<p>Here is how to start from a normal rarity, hunter-influenced Agate Amulet of item level 86:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb28-1" title="1"><span class="ex">buy</span> hunter <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span> ilvl 86</a>
<a class="sourceLine" id="cb28-2" title="2"><span class="ex">scour</span></a></code></pre></div>
<p>Here is how to start from a random rare hunter and warlord-influenced Agate Amulet of item level 100:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb29-1" title="1"><span class="ex">buy</span> hunter warlord <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></a></code></pre></div>
<p>Here is how to start from a rare ilvl 86 Agate Amulet with fractured +1 to Level of all Chaos Skill Gems and Tier 1 Dexterity (and some other random modifiers), bought for 10 Chaos Orbs:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb30-1" title="1"><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></a>
<a class="sourceLine" id="cb30-2" title="2">  <span class="ex">ilvl</span> 86</a>
<a class="sourceLine" id="cb30-3" title="3">  <span class="ex">with</span> fractured <span class="st">&quot;GlobalChaosGemLevel1&quot;</span></a>
<a class="sourceLine" id="cb30-4" title="4">  <span class="ex">with</span> <span class="st">&quot;Dexterity9&quot;</span></a>
<a class="sourceLine" id="cb30-5" title="5">  <span class="kw">for</span> <span class="ex">10</span> chaos</a></code></pre></div>
<p>Note that <code>&quot;Dexterity9&quot;</code> is Tier 1, not Tier 9. This is how modifiers are named internally in the game.</p>
<h3 id="crafting-instructions">Crafting Instructions</h3>
<h4 id="currencies">Currencies</h4>
<p>The following keywords are instructions to apply currency to the current item.</p>
<h5 id="basic-currencies">Basic Currencies</h5>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Currency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>transmute</code></td>
<td>Orb of Transmutation</td>
</tr>
<tr class="even">
<td><code>augment</code></td>
<td>Orb of Augmentation</td>
</tr>
<tr class="odd">
<td><code>alt</code></td>
<td>Orb of Alteration</td>
</tr>
<tr class="even">
<td><code>regal</code></td>
<td>Regal Orb</td>
</tr>
<tr class="odd">
<td><code>alch</code></td>
<td>Orb of Alchemy</td>
</tr>
<tr class="even">
<td><code>scour</code></td>
<td>Orb of Scouring</td>
</tr>
<tr class="odd">
<td><code>bless</code></td>
<td>Blessed Orb</td>
</tr>
<tr class="even">
<td><code>chaos</code></td>
<td>Chaos Orb</td>
</tr>
<tr class="odd">
<td><code>annul</code></td>
<td>Orb of Annulment</td>
</tr>
<tr class="even">
<td><code>exalt</code></td>
<td>Exalted Orb</td>
</tr>
</tbody>
</table>
<h5 id="conqueror-exalted-orbs">Conqueror Exalted Orbs</h5>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Currency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>crusader_exalt</code></td>
<td>Crusader Exalted Orb</td>
</tr>
<tr class="even">
<td><code>hunter_exalt</code></td>
<td>Hunter Exalted Orb</td>
</tr>
<tr class="odd">
<td><code>redeemer_exalt</code></td>
<td>Redeemer Exalted Orb</td>
</tr>
<tr class="even">
<td><code>warlord_exalt</code></td>
<td>Warlord Exalted Orb</td>
</tr>
</tbody>
</table>
<h5 id="eldritch-currencies">Eldritch Currencies</h5>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Currency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>lesser_ember</code></td>
<td>Lesser Eldritch Ember</td>
</tr>
<tr class="even">
<td><code>greater_ember</code></td>
<td>Greater Eldritch Ember</td>
</tr>
<tr class="odd">
<td><code>grand_ember</code></td>
<td>Grand Eldritch Ember</td>
</tr>
<tr class="even">
<td><code>exceptional_ember</code></td>
<td>Exceptional Eldritch Ember</td>
</tr>
<tr class="odd">
<td><code>lesser_ichor</code></td>
<td>Lesser Eldritch Ichor</td>
</tr>
<tr class="even">
<td><code>greater_ichor</code></td>
<td>Greater Eldritch Ichor</td>
</tr>
<tr class="odd">
<td><code>grand_ichor</code></td>
<td>Grand Eldritch Ichor</td>
</tr>
<tr class="even">
<td><code>exceptional_ichor</code></td>
<td>Exceptional Eldritch Ichor</td>
</tr>
<tr class="odd">
<td><code>eldritch_annul</code></td>
<td>Eldritch Orb of Annulment</td>
</tr>
<tr class="even">
<td><code>eldritch_exalt</code></td>
<td>Eldritch Exalted Orb</td>
</tr>
<tr class="odd">
<td><code>eldritch_chaos</code></td>
<td>Eldritch Chaos Orb</td>
</tr>
</tbody>
</table>
<h5 id="betrayal-currencies">Betrayal Currencies</h5>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Currency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>veiled_chaos</code></td>
<td>Veiled Chaos Orb (see also <a href="#unveiling">Unveiling</a>)</td>
</tr>
</tbody>
</table>
<h5 id="awakeners-orb">Awakener's Orb</h5>
<p>The <code>awaken</code> instruction applies an Awakener's Orb on the <a href="#set-aside-item">Set-Aside Item</a> to destroy it and add its influence to the <a href="#current-item">Current Item</a>. For instance, here is how to destroy a hunter-influenced Agate Amulet to add hunter influence to a warlord Marble Amulet:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb31-1" title="1"><span class="ex">buy</span> hunter <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></a>
<a class="sourceLine" id="cb31-2" title="2">  <span class="ex">with</span> <span class="st">&quot;AdditionalPierceInfluence1&quot;</span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="ex">set_aside</span></a>
<a class="sourceLine" id="cb31-4" title="4"><span class="ex">buy</span> warlord <span class="st">&quot;Metadata/Items/Amulet/AmuletAtlas2&quot;</span></a>
<a class="sourceLine" id="cb31-5" title="5">  <span class="ex">with</span> <span class="st">&quot;AreaOfEffectInfluence3&quot;</span></a>
<a class="sourceLine" id="cb31-6" title="6"><span class="ex">awaken</span></a></code></pre></div>
<p>This usually results in a Marble Amulet with the hunter modifier Projectiles Pierce an additional Target and the warlord modifier #% increased Area of Effect. But as both items could have more than one influenced modifier, this is not guaranteed.</p>
<h4 id="essences">Essences</h4>
<p>The following keywords are instructions to apply an essence to the current item.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Essence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>essence_of_anger</code></td>
<td>Deafening Essence of Anger</td>
</tr>
<tr class="even">
<td><code>essence_of_anguish</code></td>
<td>Deafening Essence of Anguish</td>
</tr>
<tr class="odd">
<td><code>essence_of_contempt</code></td>
<td>Deafening Essence of Contempt</td>
</tr>
<tr class="even">
<td><code>essence_of_doubt</code></td>
<td>Deafening Essence of Doubt</td>
</tr>
<tr class="odd">
<td><code>essence_of_dread</code></td>
<td>Deafening Essence of Dread</td>
</tr>
<tr class="even">
<td><code>essence_of_envy</code></td>
<td>Deafening Essence of Envy</td>
</tr>
<tr class="odd">
<td><code>essence_of_fear</code></td>
<td>Deafening Essence of Fear</td>
</tr>
<tr class="even">
<td><code>essence_of_greed</code></td>
<td>Deafening Essence of Greed</td>
</tr>
<tr class="odd">
<td><code>essence_of_hatred</code></td>
<td>Deafening Essence of Hatred</td>
</tr>
<tr class="even">
<td><code>essence_of_loathing</code></td>
<td>Deafening Essence of Loathing</td>
</tr>
<tr class="odd">
<td><code>essence_of_misery</code></td>
<td>Deafening Essence of Misery</td>
</tr>
<tr class="even">
<td><code>essence_of_rage</code></td>
<td>Deafening Essence of Rage</td>
</tr>
<tr class="odd">
<td><code>essence_of_scorn</code></td>
<td>Deafening Essence of Scorn</td>
</tr>
<tr class="even">
<td><code>essence_of_sorrow</code></td>
<td>Deafening Essence of Sorrow</td>
</tr>
<tr class="odd">
<td><code>essence_of_spite</code></td>
<td>Deafening Essence of Spite</td>
</tr>
<tr class="even">
<td><code>essence_of_suffering</code></td>
<td>Deafening Essence of Suffering</td>
</tr>
<tr class="odd">
<td><code>essence_of_torment</code></td>
<td>Deafening Essence of Torment</td>
</tr>
<tr class="even">
<td><code>essence_of_woe</code></td>
<td>Deafening Essence of Woe</td>
</tr>
<tr class="odd">
<td><code>essence_of_wrath</code></td>
<td>Deafening Essence of Wrath</td>
</tr>
<tr class="even">
<td><code>essence_of_zeal</code></td>
<td>Deafening Essence of Zeal</td>
</tr>
<tr class="odd">
<td><code>essence_of_delirium</code></td>
<td>Essence of Delirium</td>
</tr>
<tr class="even">
<td><code>essence_of_horror</code></td>
<td>Essence of Horror</td>
</tr>
<tr class="odd">
<td><code>essence_of_hysteria</code></td>
<td>Essence of Hysteria</td>
</tr>
<tr class="even">
<td><code>essence_of_insanity</code></td>
<td>Essence of Insanity</td>
</tr>
</tbody>
</table>
<h4 id="fossils">Fossils</h4>
<p>The following keywords are instructions to apply fossils to the current item. To apply multiple fossils, separate those keywords with <code>+</code>.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Fossil</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>aberrant</code></td>
<td>Aberrant Fossil</td>
</tr>
<tr class="even">
<td><code>aetheric</code></td>
<td>Aetheric Fossil</td>
</tr>
<tr class="odd">
<td><code>bound</code></td>
<td>Bound Fossil</td>
</tr>
<tr class="even">
<td><code>corroded</code></td>
<td>Corroded Fossil</td>
</tr>
<tr class="odd">
<td><code>dense</code></td>
<td>Dense Fossil</td>
</tr>
<tr class="even">
<td><code>faceted</code></td>
<td>Faceted Fossil</td>
</tr>
<tr class="odd">
<td><code>frigid</code></td>
<td>Frigid Fossil</td>
</tr>
<tr class="even">
<td><code>jagged</code></td>
<td>Jagged Fossil</td>
</tr>
<tr class="odd">
<td><code>lucent</code></td>
<td>Lucent Fossil</td>
</tr>
<tr class="even">
<td><code>metallic</code></td>
<td>Metallic Fossil</td>
</tr>
<tr class="odd">
<td><code>prismatic</code></td>
<td>Prismatic Fossil</td>
</tr>
<tr class="even">
<td><code>pristine</code></td>
<td>Pristine Fossil</td>
</tr>
<tr class="odd">
<td><code>scorched</code></td>
<td>Scorched Fossil</td>
</tr>
<tr class="even">
<td><code>serrated</code></td>
<td>Serrated Fossil</td>
</tr>
<tr class="odd">
<td><code>shuddering</code></td>
<td>Shuddering Fossil</td>
</tr>
<tr class="even">
<td><code>fundamental</code></td>
<td>Fundamental Fossil</td>
</tr>
<tr class="odd">
<td><code>deft</code></td>
<td>Deft Fossil</td>
</tr>
</tbody>
</table>
<p>For instance:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb32-1" title="1"><span class="ex">pristine</span></a></code></pre></div>
<p>applies a Primitive Resonator socketed with a Pristine Fossil.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb33-1" title="1"><span class="ex">dense</span> + fundamental</a></code></pre></div>
<p>applies a Potent Resonator socketed with a Dense Fossil and a Fundamental Fossil.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb34-1" title="1"><span class="ex">faceted</span> + aetheric + prismatic</a></code></pre></div>
<p>applies a Powerful Resonator socketed with a Faceted Fossil, an Aetheric Fossil and a Prismatic Fossil.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb35-1" title="1"><span class="ex">metallic</span> + lucent + jagged + deft</a></code></pre></div>
<p>applies a Prime Resonator socketed with a Metallic Fossil, a Lucent Fossil, a Jagged Fossil and a Deft Fossil.</p>
<h4 id="crafting-bench">Crafting Bench</h4>
<h5 id="built-ins">Built-Ins</h5>
<p>The following keywords are instructions to apply a specify crafting bench operation on the current item using the crafting bench. All of them add a given modifier, except <code>remove_crafted_mods</code> which removes all crafted modifiers.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Modifier</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>multimod</code></td>
<td>Can have up to 3 crafted modifiers</td>
</tr>
<tr class="even">
<td><code>prefixes_cannot_be_changed</code></td>
<td>Prefixes cannot be changed</td>
</tr>
<tr class="odd">
<td><code>suffixes_cannot_be_changed</code></td>
<td>Suffixes cannot be changed</td>
</tr>
<tr class="even">
<td><code>cannot_roll_attack_mods</code></td>
<td>Cannot roll attack modifiers</td>
</tr>
<tr class="odd">
<td><code>cannot_roll_caster_mods</code></td>
<td>Cannot roll caster modifiers</td>
</tr>
<tr class="even">
<td><code>remove_crafted_mods</code></td>
<td>Remove crafted mods</td>
</tr>
<tr class="odd">
<td><code>craft_any_prefix</code></td>
<td>Add a cheap modifier chosen arbitrarily from the list of available prefixes</td>
</tr>
<tr class="even">
<td><code>craft_any_suffix</code></td>
<td>Add a cheap modifier chosen arbitrarily from the list of available suffixes</td>
</tr>
</tbody>
</table>
<p>Use <code>craft_any_prefix</code> and <code>craft_any_suffix</code> when you want to craft a modifier without care for which one, for instance to add a third prefix or suffix to prevent an exalt or a reforge from adding a prefix or a suffix.</p>
<h5 id="other-modifiers">Other Modifiers</h5>
<p>To add another mod using the crafting bench, use the <code>craft &lt;identifier&gt;</code> instruction. The identifier specifies which mod to add. See <a href="#finding-identifiers">Finding Identifiers</a> to find out which identifier to use. For instance, to add Adds # to # Cold Damage (lowest tier), use:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb36-1" title="1"><span class="ex">craft</span> <span class="st">&quot;DexMasterAddedColdDamageCrafted1&quot;</span></a></code></pre></div>
<p>Note that this operation has a very low estimated cost. It is intended to be used to block modifiers. You can use it to add meta-mods but the cost will not be estimated correctly. For meta-mods, use <a href="#build-ins">Built-In</a> crafting bench operations instead.</p>
<h4 id="harvest-crafting">Harvest Crafting</h4>
<p>The following keywords are instructions to perform harvest crafts on the current item.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Craft</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>harvest_augment_attack</code></td>
<td><strong>Augment</strong> an item with a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_augment_caster</code></td>
<td><strong>Augment</strong> an item with a new <strong>Caster</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_augment_chaos</code></td>
<td><strong>Augment</strong> an item with a new <strong>Chaos</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_augment_cold</code></td>
<td><strong>Augment</strong> an item with a new <strong>Cold</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_augment_critical</code></td>
<td><strong>Augment</strong> an item with a new <strong>Critical</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_augment_defences</code></td>
<td><strong>Augment</strong> an item with a new <strong>Defences</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_augment_fire</code></td>
<td><strong>Augment</strong> an item with a new <strong>Fire</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_augment_life</code></td>
<td><strong>Augment</strong> an item with a new <strong>Life</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_augment_lightning</code></td>
<td><strong>Augment</strong> an item with a new <strong>Lightning</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_augment_physical</code></td>
<td><strong>Augment</strong> an item with a new <strong>Physical</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_augment_speed</code></td>
<td><strong>Augment</strong> an item with a new <strong>Speed</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_attack_to_attack</code></td>
<td><strong>Remove</strong> a random <strong>non-Attack</strong> modifier from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_non_caster_to_caster</code></td>
<td><strong>Remove</strong> a random <strong>non-Caster</strong> modifier from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_chaos_to_chaos</code></td>
<td><strong>Remove</strong> a random <strong>non-Chaos</strong> modifier from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_non_cold_to_cold</code></td>
<td><strong>Remove</strong> a random <strong>non-Cold</strong> modifier from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_critical_to_critical</code></td>
<td><strong>Remove</strong> a random <strong>non-Critical</strong> modifier from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_non_defences_to_defences</code></td>
<td><strong>Remove</strong> a random <strong>non-Defences</strong> modifier from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_fire_to_fire</code></td>
<td><strong>Remove</strong> a random <strong>non-Fire</strong> modifier from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_non_life_to_life</code></td>
<td><strong>Remove</strong> a random <strong>non-Life</strong> modifier from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_lightning_to_lightning</code></td>
<td><strong>Remove</strong> a random <strong>non-Lightning</strong> modifier from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_non_physical_to_physical</code></td>
<td><strong>Remove</strong> a random <strong>non-Physical</strong> modifier from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_non_speed_to_speed</code></td>
<td><strong>Remove</strong> a random <strong>non-Speed</strong> modifier from an item and add a new <strong>Attack</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_attack</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including an <strong>Attack</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_caster</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Caster</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_chaos</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Chaos</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_cold</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Cold</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_critical</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Critical</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_defences</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Defences</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_fire</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Fire</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_life</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Life</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_lightning</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Lightning</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_physical</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Physical</strong> modifier</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_speed</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Speed</strong> modifier</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_attack_more_common</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including an <strong>Attack</strong> modifier. Attack modifiers are more common</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_caster_more_common</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Caster</strong> modifier. Caster modifiers are more common</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_chaos_more_common</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Chaos</strong> modifier. Chaos modifiers are more common</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_cold_more_common</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Cold</strong> modifier. Cold modifiers are more common</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_critical_more_common</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Critical</strong> modifier. Critical modifiers are more common</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_defences_more_common</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Defences</strong> modifier. Defences modifiers are more common</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_fire_more_common</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Fire</strong> modifier. Fire modifiers are more common</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_life_more_common</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Life</strong> modifier. Life modifiers are more common</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_lightning_more_common</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Lightning</strong> modifier. Lightning modifiers are more common</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_physical_more_common</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Physical</strong> modifier. Physical modifiers are more common</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_speed_more_common</code></td>
<td><strong>Reforge</strong> an item as a rare item with random modifiers, including a <strong>Speed</strong> modifier. Speed modifiers are more common</td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_keep_prefixes</code></td>
<td><strong>Reforge</strong> a rare item, keeping all <strong>Prefixes</strong></td>
</tr>
<tr class="even">
<td><code>harvest_reforge_keep_suffixes</code></td>
<td><strong>Reforge</strong> a rare item, keeping all <strong>Suffixes</strong></td>
</tr>
<tr class="odd">
<td><code>harvest_reforge_more_likely</code></td>
<td><strong>Reforge</strong> a rare item, being much <strong>more likely</strong> to receive the same modifier types</td>
</tr>
<tr class="even">
<td><code>harvest_reforge_less_likely</code></td>
<td><strong>Reforge</strong> a rare item, being much <strong>less likely</strong> to receive the same modifier types</td>
</tr>
</tbody>
</table>
<h4 id="beastcrafting">Beastcrafting</h4>
<p>The following keywords are instructions to perform beastcrafts on the current item.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Craft</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>beastcraft_aspect_of_the_avian</code></td>
<td>Add Aspect of the Avian</td>
</tr>
<tr class="even">
<td><code>beastcraft_aspect_of_the_cat</code></td>
<td>Add Aspect of the Cat</td>
</tr>
<tr class="odd">
<td><code>beastcraft_aspect_of_the_crab</code></td>
<td>Add Aspect of the Crab</td>
</tr>
<tr class="even">
<td><code>beastcraft_aspect_of_the_spider</code></td>
<td>Add Aspect of the Spider</td>
</tr>
<tr class="odd">
<td><code>beastcraft_split</code></td>
<td>See <a href="#split">Split</a></td>
</tr>
<tr class="even">
<td><code>beastcraft_imprint</code></td>
<td>See <a href="#imprint">Imprint</a></td>
</tr>
</tbody>
</table>
<h5 id="split">Split</h5>
<p><code>beastcraft_split</code> splits the current item into two items. One of them becomes the <a href="#current-item">Current Item</a>, the other becomes the <a href="#set-aside-item">Set-Aside Item</a>.</p>
<p>You can <a href="#swap">Swap</a> the current item and the set-aside item to access the second item created by a split. For instance, to split an item that has +1 to Level of all Chaos Skill Gems and set the current item to the item that kept this modifier:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb37-1" title="1"><span class="ex">beastcraft_split</span></a>
<a class="sourceLine" id="cb37-2" title="2"><span class="kw">if</span> <span class="ex">not</span> has <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> then swap</a></code></pre></div>
<h5 id="imprint">Imprint</h5>
<p><code>beastcraft_imprint</code> sets the <a href="#current-imprint">Current Imprint</a> to an imprint of the current item.</p>
<p>The item can then be restored by <a href="#use-imprint">Using the Imprint</a>. For instance, to try and add a suffix to an item which only has one prefix which is +1 to Level of All Skill Gems:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb38-1" title="1"><span class="ex">.try_again</span>:</a>
<a class="sourceLine" id="cb38-2" title="2">  <span class="ex">beastcraft_imprint</span></a>
<a class="sourceLine" id="cb38-3" title="3">  <span class="ex">regal</span></a>
<a class="sourceLine" id="cb38-4" title="4">  <span class="kw">if</span> <span class="ex">prefix_count</span> 2 then {</a>
<a class="sourceLine" id="cb38-5" title="5">    <span class="ex">use_imprint</span></a>
<a class="sourceLine" id="cb38-6" title="6">    <span class="ex">goto</span> .try_again</a>
<a class="sourceLine" id="cb38-7" title="7">  }</a></code></pre></div>
<h4 id="betrayal-crafting">Betrayal Crafting</h4>
<p>The following keywords are instructions to perform crafting obtained through the Immortal Syndicate on the current item.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Craft</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>aisling</code></td>
<td>Aisling T4: remove a random modifier and add a new veiled modifier</td>
</tr>
</tbody>
</table>
<h5 id="unveiling">Unveiling</h5>
<p><code>unveil &lt;mods&gt; [else &lt;instruction&gt;]</code> is an instruction that unveils an item with a veiled modifier. <code>&lt;mods&gt;</code> is a list of modifier identifiers separated by <code>or</code>. The <a href="#show-unveil-mod-pool">Show Unveil Mod Pool</a> instruction can be used to easily get the identifiers for the modifiers you want to unveil. If the first modifier in <code>&lt;mods&gt;</code> has been unveiled, it is chosen. Else, if the second modifier in this list has been unveiled, it is chosen. And so on. The optional <code>else</code> branch is executed if none of the modifiers were unveiled and another modifier had to be chosen instead.</p>
<p>For instance, here is how to try to unveil life on an amulet:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb39-1" title="1"><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></a>
<a class="sourceLine" id="cb39-2" title="2"><span class="ex">veiled_chaos</span></a>
<a class="sourceLine" id="cb39-3" title="3"><span class="ex">unveil</span> <span class="st">&quot;JunMasterVeiledBaseLifeAndManaRegen_&quot;</span></a></code></pre></div>
<p>Here is how to try to unveil life or area damage or projectile damage, in this order of priority:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb40-1" title="1"><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></a>
<a class="sourceLine" id="cb40-2" title="2"><span class="ex">veiled_chaos</span></a>
<a class="sourceLine" id="cb40-3" title="3"><span class="ex">unveil</span></a>
<a class="sourceLine" id="cb40-4" title="4">  <span class="st">&quot;JunMasterVeiledBaseLifeAndManaRegen_&quot;</span> <span class="ex">or</span></a>
<a class="sourceLine" id="cb40-5" title="5">  <span class="st">&quot;JunMasterVeiledAreaDamageAndAreaOfEffect&quot;</span> <span class="ex">or</span></a>
<a class="sourceLine" id="cb40-6" title="6">  <span class="st">&quot;JunMasterVeiledProjectileDamageAndProjectileSpeed&quot;</span></a></code></pre></div>
<p>Finally, here is how to unveil life or try again:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb41-1" title="1">  <span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></a>
<a class="sourceLine" id="cb41-2" title="2"><span class="ex">.try_again</span>:</a>
<a class="sourceLine" id="cb41-3" title="3">  <span class="ex">veiled_chaos</span></a>
<a class="sourceLine" id="cb41-4" title="4">  <span class="ex">unveil</span> <span class="st">&quot;JunMasterVeiledBaseLifeAndManaRegen_&quot;</span> else goto .try_again</a></code></pre></div>
<p>This is equivalent to using an <code>if</code> as follows:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb42-1" title="1">  <span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></a>
<a class="sourceLine" id="cb42-2" title="2"><span class="ex">.try_again</span>:</a>
<a class="sourceLine" id="cb42-3" title="3">  <span class="ex">veiled_chaos</span></a>
<a class="sourceLine" id="cb42-4" title="4">  <span class="ex">unveil</span> <span class="st">&quot;JunMasterVeiledBaseLifeAndManaRegen_&quot;</span></a>
<a class="sourceLine" id="cb42-5" title="5">  <span class="kw">if</span> <span class="ex">not</span> has <span class="st">&quot;JunMasterVeiledBaseLifeAndManaRegen_&quot;</span> then goto .try_again</a></code></pre></div>
<h4 id="set-aside">Set Aside</h4>
<p>The <code>set_aside</code> instruction sets the <a href="#set-aside-item">Set-Aside Item</a> to the <a href="#current-item">Current Item</a>, then sets the current item to no item. You usually want to <a href="#buying-a-base">buy</a> another item after that to get a new current item. Then you usually want to use an <a href="#awakeners-orb">Awakener's Orb</a>.</p>
<h4 id="swap">Swap</h4>
<p>The <code>swap</code> instructions exchanges the <a href="#current-item">Current Item</a> and the <a href="#set-aside-item">Set-Aside Item</a>. It is in particular useful when <a href="#split">Splitting</a> items.</p>
<h4 id="use-imprint">Use Imprint</h4>
<p>The <code>use_imprint</code> instruction sets the <a href="#current-item">Current Item</a> to the <a href="#current-imprint">Current Imprint</a>, and sets the current imprint to no imprint.</p>
<h3 id="control-flow-instructions">Control-Flow Instructions</h3>
<p>Interesting crafts are not linear: what to do after a given step often depends on the state of the item. Kalandralang allows you to express <a href="#conditions">Conditions</a> and to jump to a different <a href="#program-point">Program Point</a>, expressed with the use of a <a href="#labels">Label</a>, depending on whether the condition holds or not.</p>
<h4 id="blocks">Blocks</h4>
<p>Everywhere you can write an instruction, you can write a block of instructions instead. A block is a sequence of instructions inside braces <code>{ ... }</code>. For instance:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb43-1" title="1"><span class="kw">{</span></a>
<a class="sourceLine" id="cb43-2" title="2">  <span class="ex">prefixes_cannot_be_changed</span></a>
<a class="sourceLine" id="cb43-3" title="3">  <span class="ex">scour</span></a>
<a class="sourceLine" id="cb43-4" title="4"><span class="kw">}</span></a></code></pre></div>
<p>is equivalent to:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb44-1" title="1"><span class="ex">prefixes_cannot_be_changed</span></a>
<a class="sourceLine" id="cb44-2" title="2"><span class="ex">scour</span></a></code></pre></div>
<p>Typically, blocks are used in conditionals and loops. For instance:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb45-1" title="1"><span class="kw">if</span> <span class="ex">open_suffix</span> then {</a>
<a class="sourceLine" id="cb45-2" title="2">  <span class="ex">prefixes_cannot_be_changed</span></a>
<a class="sourceLine" id="cb45-3" title="3">  <span class="ex">scour</span></a>
<a class="sourceLine" id="cb45-4" title="4">}</a></code></pre></div>
<p>is <em>not</em> equivalent to:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb46-1" title="1"><span class="kw">if</span> <span class="ex">open_suffix</span> then</a>
<a class="sourceLine" id="cb46-2" title="2">  <span class="ex">prefixes_cannot_be_changed</span></a>
<a class="sourceLine" id="cb46-3" title="3">  <span class="ex">scour</span></a></code></pre></div>
<p>The latter recipe applies an Orb of Scouring whether there was an open suffix or not, which is probably not what is intended according to the indentation.</p>
<p>Blocks can have any number of instructions, including zero or one: <code>{}</code> is a valid block which does nothing, and <code>{ alt }</code> is equivalent to <code>alt</code>.</p>
<h4 id="nesting-complex-instructions">Nesting Complex Instructions</h4>
<p>Complex instructions are:</p>
<ul>
<li><a href="#if-conditionals">If Conditionals</a>;</li>
<li><a href="#while-loops">While Loops</a>;</li>
<li><a href="#while-loops">Until Loops</a>;</li>
<li><a href="#while-loops">Repeat Loops</a>.</li>
</ul>
<p>Complex instructions cannot be used directly inside other complex instructions. They need to be put in a <a href="#blocks">Block</a>. For instance:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb47-1" title="1"><span class="kw">if</span> <span class="ex">open_suffix</span> then</a>
<a class="sourceLine" id="cb47-2" title="2">  <span class="kw">if</span> <span class="ex">open_prefix</span> then</a>
<a class="sourceLine" id="cb47-3" title="3">    <span class="ex">multimod</span></a>
<a class="sourceLine" id="cb47-4" title="4">  <span class="kw">else</span></a>
<a class="sourceLine" id="cb47-5" title="5">    <span class="ex">scour</span></a></code></pre></div>
<p>will fail to parse. You should write this instead:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb48-1" title="1"><span class="kw">if</span> <span class="ex">open_suffix</span> then {</a>
<a class="sourceLine" id="cb48-2" title="2">  <span class="kw">if</span> <span class="ex">open_prefix</span> then</a>
<a class="sourceLine" id="cb48-3" title="3">    <span class="ex">multimod</span></a>
<a class="sourceLine" id="cb48-4" title="4">  <span class="kw">else</span></a>
<a class="sourceLine" id="cb48-5" title="5">    <span class="ex">scour</span></a>
<a class="sourceLine" id="cb48-6" title="6">}</a></code></pre></div>
<h4 id="label-definitions">Label Definitions</h4>
<p>A <a href="#labels">Label</a> followed by a colon <code>:</code> gives a name to a program point to be able to jump to it from anywhere else in the recipe. For instance:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb49-1" title="1"><span class="ex">.start</span>:</a></code></pre></div>
<p>defines a label named <code>.start</code>. You can put this label at the beginning of your recipe to be able to jump to it later if you brick your item.</p>
<h4 id="goto">Goto</h4>
<p>The <code>goto &lt;label&gt;</code> instruction sets the <a href="#program-point">Program Point</a> to the instruction that follows the given label's definition. For instance:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb50-1" title="1"><span class="ex">.chaos-spam</span>:</a>
<a class="sourceLine" id="cb50-2" title="2">  <span class="ex">chaos</span></a>
<a class="sourceLine" id="cb50-3" title="3">  <span class="ex">goto</span> .chaos-spam</a></code></pre></div>
<p>creates an infinite loop of chaos spamming. This will in fact never end and you will have to interrupt Kalandralang using Ctrl+C.</p>
<p><code>goto</code> instructions can often be avoided using <a href="#if-conditionals">If Conditionals</a> and <a href="#loops">Loops</a>. In large programs, it is recommended to avoid them at all costs. But crafting recipes are often small, and gotos can sometimes actually make the recipe more readable.</p>
<h4 id="stop">Stop</h4>
<p>The <code>stop</code> instruction sets the <a href="#program-point">Program Point</a> to just after the last instruction of the recipe. This effectively causes the run to stop immediately. This is equivalent to putting a <a href="#labels">Label</a> at the end and using <a href="#goto">Goto</a> to jump to it.</p>
<h4 id="if-conditionals">If Conditionals</h4>
<p><code>if &lt;condition&gt; then &lt;instruction&gt;</code> executes the given instruction, but only if the condition holds. For instance:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb51-1" title="1"><span class="kw">if</span> <span class="ex">no_prefix</span> then augment</a></code></pre></div>
<p>causes an Orb of Augmentation to be applied on the current item if it has no prefix.</p>
<p>Another form of if conditionals is <code>if &lt;condition&gt; then &lt;instruction&gt; else &lt;instruction&gt;</code>. It executes the <code>then</code> instruction if the condition holds, or the <code>else</code> instruction if it doesn't. For instance:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb52-1" title="1"><span class="kw">if</span> <span class="ex">open_suffix</span> then exalt else annul</a></code></pre></div>
<p>causes an Exalted Orb to be applied on the current item if it has an open suffix, and an Orb of Annulment it its suffixes are full.</p>
<h4 id="loops">Loops</h4>
<h5 id="while-loops">While Loops</h5>
<p><code>while &lt;condition&gt; do &lt;instruction&gt;</code> executes the given instruction until the given condition no longer holds. If the condition already does not hold before the while loop, the instruction is not executed at all. For instance:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb53-1" title="1"><span class="kw">while</span> <span class="ex">not</span> has <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> do alt</a></code></pre></div>
<p>is a recipe which spams Orbs of Alteration on the current item until the item has +1 to Level of all Chaos Skill Gems. If the item already has this modifier before the loop starts, no Orb of Alteration is used at all. It is equivalent to:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb54-1" title="1"><span class="ex">.loop</span>:</a>
<a class="sourceLine" id="cb54-2" title="2">  <span class="kw">if</span> <span class="ex">has</span> <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> then goto .stop</a>
<a class="sourceLine" id="cb54-3" title="3">  <span class="ex">alt</span></a>
<a class="sourceLine" id="cb54-4" title="4">  <span class="ex">goto</span> .loop</a>
<a class="sourceLine" id="cb54-5" title="5"><span class="ex">.stop</span>:</a></code></pre></div>
<h5 id="until-loops">Until Loops</h5>
<p><code>until &lt;condition&gt; do &lt;instruction&gt;</code> executes the given instruction until the given condition holds. If the condition already holds before the while loop, the instruction is not executed at all. For instance:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb55-1" title="1"><span class="kw">until</span> <span class="ex">has</span> <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> do alt</a></code></pre></div>
<p>is equivalent to:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb56-1" title="1"><span class="kw">while</span> <span class="ex">not</span> has <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> do alt</a></code></pre></div>
<h5 id="repeat-loops">Repeat Loops</h5>
<p><code>repeat &lt;instruction&gt; until &lt;condition&gt;</code> executes the given instruction until the given condition holds. The instruction is always executed at least once. For instance:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb57-1" title="1"><span class="ex">repeat</span> alt until has <span class="st">&quot;GlobalChaosGemLevel1&quot;</span></a></code></pre></div>
<p>is equivalent to:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb58-1" title="1"><span class="ex">alt</span></a>
<a class="sourceLine" id="cb58-2" title="2"><span class="kw">until</span> <span class="ex">has</span> <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> do alt</a></code></pre></div>
<p>and to:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb59-1" title="1"><span class="ex">.loop</span>:</a>
<a class="sourceLine" id="cb59-2" title="2">  <span class="ex">alt</span></a>
<a class="sourceLine" id="cb59-3" title="3">  <span class="kw">if</span> <span class="ex">not</span> has <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> then goto .loop</a></code></pre></div>
<h3 id="selling">Selling</h3>
<p><code>gain &lt;amount&gt;</code> causes the given <a href="#amounts">Amount</a> to be added to your earnings. It is typically used at the end of recipes to estimate profit margins. For instance, let's say that you want to estimate whether spamming Orbs of Alteration to get +1 to Level of all Chaos Skill Gems is more efficient than buying on the trade site, assuming you can sell the result for 20 chaos:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb60-1" title="1"><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></a>
<a class="sourceLine" id="cb60-2" title="2"><span class="kw">until</span> <span class="ex">has</span> <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> alt</a>
<a class="sourceLine" id="cb60-3" title="3"><span class="ex">gain</span> 20 chaos</a></code></pre></div>
<p>Kalandralang will execute the recipe and display your spendings, your earnings (here 20 Chaos Orbs), and the difference between the two.</p>
<p>This is not a very interesting example though because you can just add 20 chaos from the spendings in your head. However, when combined with <a href="#if-conditionals">If Conditionals</a>, you can tell Kalandralang that the selling price depends on which mods the item has. For instance:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb61-1" title="1"><span class="ex">buy</span> <span class="st">&quot;Metadata/Items/Amulets/Amulet9&quot;</span></a>
<a class="sourceLine" id="cb61-2" title="2"><span class="kw">until</span> <span class="ex">has</span> <span class="st">&quot;GlobalChaosGemLevel1&quot;</span> alt</a>
<a class="sourceLine" id="cb61-3" title="3"><span class="ex">gain</span> 20 chaos</a>
<a class="sourceLine" id="cb61-4" title="4"><span class="kw">if</span> <span class="ex">has</span> <span class="st">&quot;Dexterity9&quot;</span> gain 30 chaos</a></code></pre></div>
<p>The earnings of this recipe depend on whether the item ends up with Tier 1 Dexterity or not. If it does end up with Tier 1 Dexterity, the earnings are 50 chaos. Otherwise, they are 20 chaos. This is particularly useful for recipes that can fail but for which the resulting item is still sellable.</p>
<h3 id="other-instructions">Other Instructions</h3>
<h4 id="echo">Echo</h4>
<p><code>echo &lt;string&gt;</code> causes Kalandralang to output the given string. This is useful to know what is happening when debugging recipes, or simply to comment on what is going on. For instance:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb62-1" title="1"><span class="bu">echo</span> <span class="st">&quot;Will now try to obtain a veiled mod through Aisling.&quot;</span></a></code></pre></div>
<h4 id="show">Show</h4>
<p><code>show</code> causes Kalandralang to output the current item and the total amount we spent up to now. This is useful when debugging recipes, or simply to mark milestones in the recipe. It can typically be preceded by <code>echo</code>, for instance:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb63-1" title="1"><span class="bu">echo</span> <span class="st">&quot;Prefixes are done:&quot;</span></a>
<a class="sourceLine" id="cb63-2" title="2"><span class="ex">show</span></a></code></pre></div>
<h4 id="show-mod-pool">Show Mod Pool</h4>
<p><code>show_mod_pool</code> causes Kalandralang to output the mods that could be added to the current item and the chance to add them when adding a single modifier (e.g. using an Exalted Orb). This also shows the <a href="#identifiers">Identifier</a> of each mod.</p>
<p>This does not show mods that are blocked by other existing modifiers. If the suffixes are full, it will not show any suffix, and if the prefixes are full, it will not show any prefix. In particular, if the item rarity is normal, this will never show anything.</p>
<p>Example:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb64-1" title="1"><span class="bu">echo</span> <span class="st">&quot;Modifiers that can be added:&quot;</span></a>
<a class="sourceLine" id="cb64-2" title="2"><span class="ex">show_mod_pool</span></a></code></pre></div>
<h4 id="show-unveil-mod-pool">Show Unveil Mod Pool</h4>
<p><code>show_unveil_mod_pool</code> causes Kalandralang to output the mods that could be unveiled on the current item. This also shows the <a href="#identifiers">Identifier</a> of each mod.</p>
<p>This does not show mods that are blocked by other existing modifiers. It requires a veiled mod to be present and it only shows prefixes or suffixes, depending on whether the veiled mod is a prefix or suffix.</p>
<p>Example:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb65-1" title="1"><span class="ex">veiled_chaos</span></a>
<a class="sourceLine" id="cb65-2" title="2"><span class="bu">echo</span> <span class="st">&quot;Modifiers that can be unveiled:&quot;</span></a>
<a class="sourceLine" id="cb65-3" title="3"><span class="ex">show_unveil_mod_pool</span></a></code></pre></div>
<h3 id="amounts">Amounts</h3>
<p>Amounts are sequences of numbers followed by currencies. More precisely, amounts are of the form <code>(&lt;number&gt; &lt;currency&gt;)*</code>. For instance:</p>
<ul>
<li><code>10 chaos</code> means 10 Chaos Orbs;</li>
<li><code>1 exalt 10 annul</code> means 1 Exalted Orb and 10 Orbs of Annulment.</li>
</ul>
<p>All <a href="#crafting-instructions">Crafting Instructions</a> can be used as currencies. This includes <a href="#currencies">Currency</a> instructions of course, but also <a href="#harvest-crafting">Harvest Crafts</a>, <a href="#beastcrafting">Beastcrafts</a>, <a href="#betrayal-crafting">Betrayal Crafting</a>, and all operations from the <a href="#crafting-bench">Crafting Bench</a>. For instance, <code>1 harvest_augment_fire</code> is a valid amount.</p>
<h3 id="conditions">Conditions</h3>
<p>Conditions are expressions that can be used in <a href="#if-conditionals">If Conditionals</a> and <a href="#loops">Loops</a>.</p>
<h4 id="constants">Constants</h4>
<p>The following keywords are conditions expressions:</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>true</code></td>
<td>A condition which always holds</td>
</tr>
<tr class="even">
<td><code>false</code></td>
<td>A condition which never holds</td>
</tr>
</tbody>
</table>
<h4 id="boolean-operators">Boolean Operators</h4>
<p>The following operators can be used to combine conditions:</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Usage</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>not</code></td>
<td><code>not &lt;condition&gt;</code></td>
<td>Negate a condition</td>
</tr>
<tr class="even">
<td><code>and</code></td>
<td><code>&lt;condition&gt; and &lt;condition&gt;</code></td>
<td>Conjunction of two conditions: holds if both conditions hold</td>
</tr>
<tr class="odd">
<td><code>or</code></td>
<td><code>&lt;condition&gt; or &lt;condition&gt;</code></td>
<td>Disjunction of two conditions: holds if at least one of the two conditions hold</td>
</tr>
</tbody>
</table>
<h4 id="parentheses-in-conditions">Parentheses in Conditions</h4>
<p><code>not</code> has higher precedence than <code>and</code>, which has higher precedence than <code>or</code>. What this means is that the following expression:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb66-1" title="1"><span class="ex">not</span> open_suffix or no_prefix and full_prefixes</a></code></pre></div>
<p>Is equivalent to:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb67-1" title="1"><span class="kw">((</span>not open_suffix) or (no_prefix and full_prefixes))</a></code></pre></div>
<p>Parentheses <code>( ... )</code> can be used around any condition. If operator precedence does not result in what you want, use parentheses. For instance:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb68-1" title="1"><span class="ex">not</span> ((open_suffix or no_prefix) <span class="ex">and</span> full_prefixes)</a></code></pre></div>
<p>gives a completely different meaning to the expression. If you don't understand precedence, just use parentheses everywhere!</p>
<h4 id="predicates-on-current-item">Predicates on Current Item</h4>
<p>The following expressions are conditions that hold depending on the current item.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Usage</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>has</code></td>
<td><code>has &lt;identifier&gt;</code></td>
<td>Holds if the item has the modifier denoted by the given identifier.</td>
</tr>
<tr class="even">
<td><code>open_prefix</code></td>
<td><code>open_prefix</code></td>
<td>Holds if the item has at least one open prefix. This is <em>not</em> equivalent to <code>prefix_count 0..2</code> as it depends on the item's rarity.</td>
</tr>
<tr class="odd">
<td><code>full_prefixes</code></td>
<td><code>full_prefixes</code></td>
<td>Holds if the item cannot have more prefixes. This is <em>not</em> equivalent to <code>prefix_count 3</code> as it depends on the item's rarity.</td>
</tr>
<tr class="even">
<td><code>open_suffix</code></td>
<td><code>open_suffix</code></td>
<td>Holds if the item has at least one open suffix. This is <em>not</em> equivalent to <code>suffix_count 0..2</code> as it depends on the item's rarity.</td>
</tr>
<tr class="odd">
<td><code>full_suffixes</code></td>
<td><code>full_suffixes</code></td>
<td>Holds if the item cannot have more suffixes. This is <em>not</em> equivalent to <code>suffix_count 3</code> as it depends on the item's rarity.</td>
</tr>
<tr class="even">
<td><code>open_affix</code></td>
<td><code>open_affix</code></td>
<td>Holds if the item has at least one open prefix or suffix. This is <em>not</em> equivalent to <code>affix_count 0..5</code> as it depends on the item's rarity.</td>
</tr>
<tr class="odd">
<td><code>full_affixes</code></td>
<td><code>full_affixes</code></td>
<td>Holds if the item can have neither more prefixes nor more suffixes. This is <em>not</em> equivalent to <code>affix_count 6</code> as it depends on the item's rarity.</td>
</tr>
</tbody>
</table>
<p>The following expressions are deprecated and may be removed in future versions, use <a href="#comparisons">Comparisons</a> on <a href="#item-properties">Item Properties</a> instead:</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Usage</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>prefix_count</code></td>
<td><code>prefix_count &lt;number1&gt;..&lt;number2&gt;</code></td>
<td>Same as <code>&lt;number1&gt; &lt;= prefix_count &lt;= &lt;number2&gt;</code>.</td>
</tr>
<tr class="even">
<td></td>
<td><code>prefix_count &lt;number&gt;</code></td>
<td>Same as <code>prefix_count = &lt;number&gt;</code>.</td>
</tr>
<tr class="odd">
<td><code>no_prefix</code></td>
<td><code>no_prefix</code></td>
<td>Same as <code>prefix_count = 0</code>.</td>
</tr>
<tr class="even">
<td><code>suffix_count</code></td>
<td><code>suffix_count &lt;number1&gt;..&lt;number2&gt;</code></td>
<td>Same as <code>&lt;number1&gt; &lt;= suffix_count &lt;= &lt;number2&gt;</code>.</td>
</tr>
<tr class="odd">
<td></td>
<td><code>suffix_count &lt;number&gt;</code></td>
<td>Same as <code>suffix_count = &lt;number&gt;</code>.</td>
</tr>
<tr class="even">
<td><code>no_suffix</code></td>
<td><code>no_suffix</code></td>
<td>Same as <code>suffix_count = 0</code>.</td>
</tr>
<tr class="odd">
<td><code>affix_count</code></td>
<td><code>affix_count &lt;number1&gt;..&lt;number2&gt;</code></td>
<td>Same as <code>&lt;number1&gt; &lt;= affix_count &lt;= &lt;number2&gt;</code>.</td>
</tr>
<tr class="even">
<td></td>
<td><code>affix_count &lt;number&gt;</code></td>
<td>Same as <code>affix_count = &lt;number&gt;</code>.</td>
</tr>
<tr class="odd">
<td><code>no_affix</code></td>
<td><code>no_affix</code></td>
<td>Same as <code>affix_count = 0</code>.</td>
</tr>
</tbody>
</table>
<h4 id="comparisons">Comparisons</h4>
<p>The following expressions allow to compare the result of <a href="#arithmetic-expressions">Arithmetic Expressions</a> together.</p>
<table>
<thead>
<tr class="header">
<th>Operator</th>
<th>Usage</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>=</code></td>
<td><code>&lt;expr1&gt; = &lt;expr2&gt;</code></td>
<td><code>&lt;expr1&gt;</code> is equal to <code>&lt;expr2&gt;</code></td>
</tr>
<tr class="even">
<td><code>&lt;&gt;</code></td>
<td><code>&lt;expr1&gt; &lt;&gt; &lt;expr2&gt;</code></td>
<td><code>&lt;expr1&gt;</code> is not equal to <code>&lt;expr2&gt;</code></td>
</tr>
<tr class="odd">
<td><code>&lt;</code></td>
<td><code>&lt;expr1&gt; &lt; &lt;expr2&gt;</code></td>
<td><code>&lt;expr1&gt;</code> is smaller than <code>&lt;expr2&gt;</code></td>
</tr>
<tr class="even">
<td><code>&lt;=</code></td>
<td><code>&lt;expr1&gt; &lt;= &lt;expr2&gt;</code></td>
<td><code>&lt;expr1&gt;</code> is smaller than, or equal to <code>&lt;expr2&gt;</code></td>
</tr>
<tr class="odd">
<td><code>&gt;</code></td>
<td><code>&lt;expr1&gt; &gt; &lt;expr2&gt;</code></td>
<td><code>&lt;expr1&gt;</code> is greater than <code>&lt;expr2&gt;</code></td>
</tr>
<tr class="even">
<td><code>&gt;=</code></td>
<td><code>&lt;expr1&gt; &gt;= &lt;expr2&gt;</code></td>
<td><code>&lt;expr1&gt;</code> is greater than, or equal to <code>&lt;expr2&gt;</code></td>
</tr>
</tbody>
</table>
<p>You can also write double comparisons <code>&lt;expr1&gt; &lt;operator1&gt; &lt;expr2&gt; &lt;operator2&gt; &lt;expr3&gt;</code>. Those are equivalent to <code>&lt;expr1&gt; &lt;operator1&gt; &lt;expr2&gt; and &lt;expr2&gt; &lt;operator2&gt; &lt;expr3&gt;</code>. For instance:</p>
<pre><code>1 &lt;= prefix_count &lt;= 3
</code></pre>
<p>is a condition that holds if the current item has between 1 and 3 prefixes.</p>
<h3 id="arithmetic-expressions">Arithmetic Expressions</h3>
<p>Arithmetic expressions are expressions that evaluate into numbers. They can be used in <a href="#comparisons">Comparisons</a>.</p>
<h4 id="constants-1">Constants</h4>
<p>Integer constants are sequences of digits (<code>0</code> to <code>9</code>). Negative numbers are prefixed by a minus character (<code>-</code>). For instance, <code>1234</code>, <code>01</code> and <code>-32</code> are integer constants.</p>
<h4 id="operators">Operators</h4>
<p>The following expressions allow to perform arithmetic operations on arithmetic expressions.</p>
<table>
<thead>
<tr class="header">
<th>Operator</th>
<th>Usage</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-</code> (unary)</td>
<td><code>- &lt;expr1&gt;</code></td>
<td>Negation of <code>&lt;expr1&gt;</code></td>
</tr>
<tr class="even">
<td><code>+</code></td>
<td><code>&lt;expr1&gt; + &lt;expr2&gt;</code></td>
<td>Addition of <code>&lt;expr1&gt;</code> and <code>&lt;expr2&gt;</code></td>
</tr>
<tr class="odd">
<td><code>-</code> (binary)</td>
<td><code>&lt;expr1&gt; - &lt;expr2&gt;</code></td>
<td>Subtraction of <code>&lt;expr1&gt;</code> and <code>&lt;expr2&gt;</code></td>
</tr>
<tr class="even">
<td><code>*</code></td>
<td><code>&lt;expr1&gt; * &lt;expr2&gt;</code></td>
<td>Multiplication of <code>&lt;expr1&gt;</code> and <code>&lt;expr2&gt;</code></td>
</tr>
<tr class="odd">
<td><code>/</code></td>
<td><code>&lt;expr1&gt; / &lt;expr2&gt;</code></td>
<td>Division of <code>&lt;expr1&gt;</code> by <code>&lt;expr2&gt;</code></td>
</tr>
</tbody>
</table>
<h4 id="parentheses-in-arithmetic-expressions">Parentheses in Arithmetic Expressions</h4>
<p>Operators follow the usual precedence rules: <code>*</code> and <code>/</code> have higher precedence than <code>+</code> and <code>-</code> (binary). <code>-</code> (unary) have the highest precedence. All operators are left-associative.</p>
<p>Parentheses <code>( ... )</code> can be used around any arithmetic expression.</p>
<p>See also <a href="#parentheses-in-conditions">Parentheses in Conditions</a>.</p>
<h4 id="item-properties">Item Properties</h4>
<p>The following expressions allow to get numeric properties from the current item.</p>
<table>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Usage</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>prefix_count</code></td>
<td><code>prefix_count</code></td>
<td>Evaluates to the number of prefixes the current item has.</td>
</tr>
<tr class="even">
<td><code>suffix_count</code></td>
<td><code>suffix_count</code></td>
<td>Evaluates to the number of suffixes the current item has.</td>
</tr>
<tr class="odd">
<td><code>affix_count</code></td>
<td><code>affix_count</code></td>
<td>Evaluates to the number of affixes (prefixes + suffixes) the current item has.</td>
</tr>
<tr class="even">
<td><code>tier</code></td>
<td><code>tier &lt;mod_group&gt;</code></td>
<td>See <a href="#modifier-tiers">Modifier Tiers</a>.</td>
</tr>
</tbody>
</table>
<h5 id="modifier-tiers">Modifier Tiers</h5>
<p>Mod groups are <a href="#identifiers">Identifiers</a> that are shared by several modifiers. For instance, all modifiers that add Strength are part of mod group <code>&quot;Strength&quot;</code>. The <a href="#finding-identifiers">Find Command</a> can tell you the mod group of modifiers.</p>
<p>If the current item has a modifier from group <code>&lt;mod_group&gt;</code>, expression <code>tier &lt;mod_group&gt;</code> evaluates to the tier that this modifier has in this group. If the current item has no modifier from this group, this expression evaluates to 999.</p>
<p>For instance, if the item has the best possible Strength modifier that can spawn on the current item, <code>tier &quot;Strength&quot;</code> evaluates to 1. If the item has the second best possible Strength modifier, this expression evaluates to 2, and so on.</p>
<p>Note that tiers depend on the item. For instance, the best +#-# to Maximum Life modifier is not the same modifier for Body Armours and for Gloves. Tier 1 Life on Gloves adds 80 to 89 Life, while this mod is only Tier 5 on Body Armours.</p>
<p>For instance, here is how to chaos spam an item until it has three attribute modifiers, either Tier 1 + Tier 1 + Tier 4 or better, or Tier 1 + Tier 2 + Tier 3 or better, or Tier 2 + Tier 2 + Tier 2 or better:</p>
<pre><code>until
  tier &quot;Dexterity&quot; +
  tier &quot;Intelligence&quot; +
  tier &quot;Strength&quot; &lt;= 6
do
  chaos
</code></pre>
</body>
</html>
